language: c
sudo: false
before_install:
  - "/sbin/start-stop-daemon --start --quiet --pidfile /tmp/custom_xvfb_1.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :1 -ac -screen 0 1280x1024x16"
  - sleep 3
  - export DISPLAY=:1.0
  - wget https://downloads.arduino.cc/arduino-1.6.12-linux64.tar.xz
  - tar xf arduino-1.6.12-linux64.tar.xz
  - mv arduino-1.6.12 $HOME/arduino_ide
  # Make sure the Arduino command is added to the path
  - export ARDUINO_HOME="$HOME/arduino_ide"
  - export ARDUINO_LIBS="$ARDUINO_HOME/libraries"
  - export PATH="$ARDUINO_HOME:$PATH"
install:
#  - ln -s $PWD /usr/local/share/arduino/libraries/WiFiManager
# boards manager not working on 1.6.7 - 1.6.8
  - arduino --pref "boardsmanager.additional.urls=http://arduino.esp8266.com/stable/package_esp8266com_index.json" --save-prefs
# install lib arduino json not working in 1.6.5
#  - arduino --install-library "ArduinoJson"
  - git clone https://github.com/markruys/arduino-DHT.git $ARDUINO_LIBS/arduino-DHT
  - git clone https://github.com/tzapu/WiFiManager.git $ARDUINO_LIBS/WiFiManager
  - git clone https://github.com/bblanchon/ArduinoJson $ARDUINO_LIBS/ArduinoJson
# Removing "Spurious" directory from ArduinoJson
  - rm -rf $ARDUINO_LIBS/ArduinoJson/.github
  - arduino --install-boards esp8266:esp8266
  - arduino --board esp8266:esp8266:generic --save-prefs
  - arduino --pref "compiler.warning_level=default" --save-prefs
  - sleep 3
script:
  - "echo $ARDUINO_HOME"
  - "echo $ARDUINO_LIBS"
  - "echo $PWD"
  - "echo $HOME"
  - "ls $PWD"
  - arduino -v --verbose --verify --board esp8266:esp8266:generic $PWD/esp8266-dht22-sleeper-node.ino
#  - source $TRAVIS_BUILD_DIR/travis/common.sh
#  - build_examples
#  - "cat $PWD/examples/AutoConnect/AutoConnect.ino"
#  - arduino -v --verbose-build --verify $PWD/examples/AutoConnect/AutoConnect.ino
#  - arduino --verify --board arduino:avr:uno $PWD/examples/IncomingCall/IncomingCall.ino
#  - arduino --verify --board arduino:avr:uno $PWD/examples/AdafruitIO_GPS/AdafruitIO_GPS.ino
after_success:
  - bash <(curl -s https://codecov.io/bash)
notifications:
  email:
    on_success: change
    on_failure: change
